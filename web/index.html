<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Rapor Sistemi - Duplicate Detection</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <script>
        // Check if user is logged in
        const session = JSON.parse(localStorage.getItem('userSession'));
        if (!session) {
            window.location.href = 'login.html';
        }
        
        // Check if system is configured
        const config = JSON.parse(localStorage.getItem('systemConfig'));
        if (!config) {
            window.location.href = 'data_selection.html';
        }
    </script>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <img src="https://ffo3gv1cf3ir.merlincdn.net/SiteAssets/Bireysel/Navigasyon/turkcell-logo.png?20251016_03" 
                     alt="Turkcell Logo" 
                     style="height: 32px; margin-right: 12px;">
                <h1>Bug Rapor Sistemi</h1>
            </div>
            <div class="header-stats">
                <div class="stat">
                    <span class="stat-value" id="totalReports">14,267</span>
                    <span class="stat-label">Toplam Rapor</span>
                </div>
                <div class="stat">
                    <span class="stat-value stat-success" id="duplicatesFound">0</span>
                    <span class="stat-label">Bulunan Benzer</span>
                </div>
                <div class="stat" style="background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%); cursor: pointer;" onclick="showUserMenu()">
                    <span class="stat-label" id="userNameDisplay"></span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Report Form Section -->
            <section class="form-section">
                <div class="section-header">
                    <h2>Benzer Rapor Ara</h2>
                    <p class="section-description">Rapor detaylarını girin - benzer raporlar otomatik olarak aranacak</p>
                </div>

                <form id="reportForm" class="report-form">
                    <!-- Dynamic Search Fields (Generated by JavaScript) -->
                    <div id="dynamicSearchFields">
                        <div style="text-align: center; padding: var(--spacing-xl); color: var(--gray-500);">
                            Arama alanları yükleniyor...
                        </div>
                    </div>

                    <!-- Search Button -->
                    <button type="submit" class="btn btn-primary" id="searchBtn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Benzer Raporları Ara</span>
                    </button>
                </form>

                <!-- Selected Columns Info -->
                <div id="selectedColumnsInfo" style="margin-top: 16px; padding: 16px; background: linear-gradient(135deg, #FFF9E6 0%, #FFE5B4 100%); border-radius: 8px; border: 2px solid var(--primary-color);">
                    <div style="font-size: 0.9rem; color: var(--secondary-color); font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                        Cross-Encoder İçin Seçili Sütunlar
                        <span style="background: var(--primary-color); color: var(--secondary-color); padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;">ARAMA</span>
                    </div>
                    <div id="selectedColumnsList" style="font-size: 0.85rem; color: #1E3A8A; font-weight: 600;"></div>
                    <div style="font-size: 0.75rem; color: #aaaaaa; margin-top: 8px;">
                        Arama bu sütunlar üzerinden yapılacak
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="loading-state" style="display: none;">
                    <div class="spinner"></div>
                    <p>Benzer raporlar aranıyor...</p>
                    <div class="loading-details">
                        <div class="loading-step">
                            <div class="loading-step-text">FAISS ile hızlı tarama...</div>
                        </div>
                        <div class="loading-step">
                            <div class="loading-step-text">Cross-Encoder ile detaylı analiz...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="resultsSection" style="display: none;">
                <div class="section-header">
                    <h2>Benzer Raporlar</h2>
                    <div class="results-meta">
                        <span id="resultsCount" class="results-count">0 sonuç</span>
                        <span id="searchTime" class="search-time">~0.0s</span>
                    </div>
                </div>

                <!-- Warning Banner -->
                <div id="warningBanner" class="warning-banner" style="display: none;">
                    <div class="warning-icon"></div>
                    <div class="warning-content">
                        <strong>Benzer raporlar bulundu!</strong>
                        <p>Bu sorun daha önce raporlanmış olabilir. Lütfen aşağıdaki raporları inceleyin ve mevcut bir rapora ek bilgi eklemek yerine yeni rapor açıp açmayacağınızı değerlendirin.</p>
                    </div>
                </div>

                <!-- Results List -->
                <div id="resultsList" class="results-list">
                    <!-- Results will be dynamically inserted here -->
                </div>

                <!-- No Results State -->
                <div id="noResults" class="no-results" style="display: none;">
                    <h3>Benzer rapor bulunamadı</h3>
                    <p>Bu sorun daha önce raporlanmamış. Yeni rapor oluşturabilirsiniz.</p>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>Hybrid Search System (FAISS + Cross-Encoder) • 4x daha hızlı • %97 accuracy</p>
                <p class="footer-meta">Powered By <strong>Esra CEVİK</strong></p>
            </div>
        </footer>
    </div>

    <script src="app.js?v=5007"></script>
    <script src="stars.js"></script>
</body>
</html>

